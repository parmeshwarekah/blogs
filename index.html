<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark light">
  <title>Blogs of Parmeshwar</title>
  <link rel="stylesheet" href="style.css">

  <style>
    body {
      background: #000;
      color: #ddd;
      margin: 0;
      font-family: system-ui, sans-serif;
    }

    .main {
      padding-top: 3rem;   /* space above everything */
      padding-bottom: 3rem;
    }

    .site-title {
      font-size: 3rem;
      font-weight: 700;
      margin-top: 2rem;
    }

    .tagline {
      font-style: italic;
      display: block;
      margin-bottom: 5rem;   /* increased gap below tagline */
    }

    .entry-time {
      font-size: 0.9rem;
      color: #aaa;
      margin-bottom: 0.3rem;
    }

    .entry-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin: 0.4rem 0;
    }

    .entry-text {
      font-size: 1.05rem;
      line-height: 1.6;
      margin-bottom: 0.8rem;
    }
  </style>
</head>

<body>

  <!-- Hamburger / Close toggle -->
  <button id="hamb" aria-label="Open calendar" class="hamb" title="Open calendar">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
      <line x1="16" y1="2" x2="16" y2="6"/>
      <line x1="8" y1="2" x2="8" y2="6"/>
      <line x1="3" y1="10" x2="21" y2="10"/>
    </svg>
  </button>

  <button id="closePanelBtn" aria-label="Close calendar" class="close-hamb">✕</button>

  <!-- Slide-in panel -->
  <aside id="panel" class="panel" aria-hidden="true">
    <div class="panel-inner">
      <header class="panel-header">
        <div class="panel-title">Choose date</div>
      </header>

      <div class="calendar-controls">
        <select id="monthSelect" aria-label="Month"></select>
        <select id="yearSelect" aria-label="Year"></select>
      </div>

      <div id="calendar" class="calendar" role="grid" aria-label="Calendar"></div>

      <div class="panel-footer">
        <button id="todayBtn" class="minor">Jump to Today</button>
      </div>
    </div>
  </aside>

  <!-- Main content -->
  <main id="main" class="main" role="main">
    <div class="logo-area" aria-hidden="true"></div>

    <h1 class="site-title">Blogs of Parmeshwar</h1>
    <p class="tagline">Ekah . Ekahtra SENA</p>

    <article id="post" class="post" aria-live="polite"></article>

    <footer class="foot">
      <p>© Parmeshwar Ekah </p>
    </footer>
  </main>

  <script src="script.js"></script>

  <script>
  // ------------------ Load Entries from GitHub API ------------------
  async function loadFromGitHub() {
    const username = "parmeshwarekah";
    const repo = "blogs";
    const path = "entries.json";

    // Add timestamp to force fresh fetch (bypass GitHub cache)
    const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${path}?t=${Date.now()}`;

    try {
      const res = await fetch(apiUrl, {
        cache: "no-store",
        headers: { "Cache-Control": "no-cache" }
      });

      if (!res.ok) throw new Error("entries.json not found");
      const json = await res.json();

      // Decode base64 GitHub content
      const decoded = atob(json.content);
      const data = JSON.parse(decoded);

      // Merge with local entries
      const local = JSON.parse(localStorage.getItem("journalPosts")) || {};
      const merged = { ...data, ...local };
      localStorage.setItem("journalPosts", JSON.stringify(merged));
      console.log("✅ Loaded fresh entries from GitHub API");
    } catch (err) {
      console.error("⚠️ Could not load GitHub entries:", err);
    }
  }

  // ------------------ Render Logic ------------------
  function loadEntriesForDate(date) {
    const container = document.getElementById("post");
    const journal = JSON.parse(localStorage.getItem("journalPosts")) || {};
    container.innerHTML = "";

    if (!journal[date] || journal[date].length === 0) {
      container.innerHTML = "<p>No entries for this date.</p>";
      return;
    }

    const dayEntries = journal[date]
      .sort((a, b) => new Date(b.created) - new Date(a.created))
      .map(entry => `
        <div class="entry-block">
          <p class="entry-time">[${formatDateShort(date)} ${entry.time}]</p>
          ${entry.title ? `<p class="entry-title">${entry.title}</p>` : ""}
          <p class="entry-text">${entry.text.replace(/\n/g, "<br>")}</p>
          <hr class="entry-separator">
        </div>
      `)
      .join("");

    container.innerHTML = dayEntries;
  }

  function formatDateShort(dateString) {
    const date = new Date(dateString);
    const day = date.getDate();
    const month = date.toLocaleString("en-GB", { month: "short" });
    const year = date.getFullYear();
    return `${day} ${month} ${year}`;
  }

  function renderEntries() {
    const container = document.getElementById("post");
    const journal = JSON.parse(localStorage.getItem("journalPosts")) || {};
    const allDates = Object.keys(journal).sort((a, b) => new Date(b) - new Date(a));

    if (allDates.length === 0) {
      container.innerHTML = "<p>No entries yet.</p>";
    } else {
      let output = "";
      allDates.forEach(date => {
        const entries = journal[date].sort((a, b) => new Date(b.created) - new Date(a.created));
        entries.forEach(entry => {
          output += `
            <div class="entry-block">
              <p class="entry-time">[${formatDateShort(date)} ${entry.time}]</p>
              ${entry.title ? `<p class="entry-title">${entry.title}</p>` : ""}
              <p class="entry-text">${entry.text.replace(/\n/g, "<br>")}</p>
              <hr class="entry-separator">
            </div>
          `;
        });
      });
      container.innerHTML = output;
    }
  }

  // ------------------ Initialize ------------------
  (async function() {
    await loadFromGitHub();   // pull fresh copy from GitHub
    renderEntries();          // then show it
  })();
  </script>

</body>
</html>
